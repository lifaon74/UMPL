Object.prototype.toString = function() {
	return JSON.stringify(this);
};


String.eol = "\n";

String.tab = function(tab) {
	var str = "";
	for(var i = 0; i < tab; i++) { str += "\t"; }
	return str
};

String.toStandardPath = function(path, isFolder) {
	var _path = (new RegExp('\\\\', 'g')).replace(path, '/');
	if(isFolder) {
		if(_path[_path.length - 1] != "/") {
			_path += "/";
		}
	}
	return _path;
};


String.parsePath = function(path, isFolder) {
	path = String.toStandardPath(path, isFolder);
	var reservedChars = "<>:\"/\\|?*";

	var match = (new RegExp("^([a-zA-Z]\:/)([^" + RegExp.quote(reservedChars) + "]+/)*$", 'g')).matchAll(path);
};	

			
String.prototype.escapeSpecialChars = function() {
	return JSON.stringify(this);
};

String.prototype.elegantLineBreak = function() {
	var str = (new RegExp("(\\\\r?\\\\n)((?:\\\\t)*)", "g")).replace(this, function(match) {
		var eol = "\"\\n\"";
		//var eol = "String.eol";
		var tabs = (new RegExp("\\\\t", "g")).replace(match.variables[1], "\t");
		//var tabs = "String.tab(" + (new RegExp("\\\\t", "g")).matchAll(match.variables[1]).length + ")";
		
		return "\" + " + eol + " + \n" + tabs + "\"" + match.variables[1] + "";
	});
	
	//str = (new RegExp(RegExp.quote('""') + "([^\\+])\\+", "g")).replace(str, "");
		
	return str;
};

String.prototype.tab = function() {
	return "\t" + ((new RegExp("(\r?\n)", "g")).replace(this, "$1\t"));
};



var Timer = function() {
	this.clear();	
};

Timer.prototype.diff = function() {
	var diff = process.hrtime(this.time);
	return diff[0] * 1e9 + diff[1];
};

Timer.prototype.disp = function(string) {
	console.log(string + " " + (this.diff() / 1e6) + "ms");
};

Timer.prototype.clear = function() {
	this.time = process.hrtime();	
};


var time_this = function(callback) {
	callback(new Timer());
};

/*time_this(function(timer) {
	var t = (new Date()).getTime();
	while(((new Date()).getTime() - t) < 1000) {
	};
	
	timer.disp("took");
});*/

var createClass = function(_classFunction, _className) {
	var _classWrapper = function() {
		var self = this;
		_classFunction.apply(self, arguments);
	};
	
	_classWrapper.name = _className;
	
	_classWrapper.parents = [];
	_classWrapper.extend = function() {
		for(var i = 0; i < arguments.length; i++) {
			var _parentClass = arguments[i];
			if(typeof _parentClass.name != 'undefined') {
				_classWrapper.parents[_parentClass.name] = _parentClass;
			}
			
			for(var elt in _parentClass.prototype) {
				_classWrapper.prototype[elt] = _parentClass.prototype[elt];
			}
		}
		
		return this;
	};
	
	_classWrapper.prototype.new = function() {
		return new _classWrapper();
	};

	return _classWrapper;
};


var BindClass = function() {
	this._binds = [];
};

BindClass.prototype.bind = function(eventName, callback) {
	var self = this;

	if(!(callback instanceof Function)) { return; }
				
	if(typeof self._binds[eventName] == 'undefined') {
		self._binds[eventName] = [];
	}
	
	var bind = {
		eventName	: eventName,
		callback	: callback
	};
	
	self._binds[eventName].push(bind);
	
	if(eventName != 'bind') {
		self.trigger('bind', bind);
	}
	
	return bind;
};

BindClass.prototype.unbind = function(eventName) {
	var self = this;

	if(typeof eventName == "string") {
		if(typeof self._binds[eventName] != 'undefined') {
			for(var i = 0; i < self._binds[eventName].length; i++) {
				self.trigger('unbind', self._binds[eventName][i]);
			}
			delete self._binds[eventName];
		}
	} else { // passed a bind object
		var bind = eventName;
		for(var i = 0; i < self._binds[bind.eventName].length; i++) {
			if(self._binds[bind.eventName][i] == bind) {
				self.trigger('unbind', self._binds[bind.eventName][i]);
				self._binds[bind.eventName].splice(i, 1);
			}
		}
	}
	
	return self;
};

BindClass.prototype.trigger = function(eventName, params) {
	var self = this;
	
	if(typeof params == 'undefined') {
		var params =  [];
	}
	
	
	if(typeof self._binds[eventName] != 'undefined') {
		for(var i = 0; i < self._binds[eventName].length; i++) {
			self._binds[eventName][i].callback.apply(this, params);
		}
	}
	
	if(self['on' + eventName] instanceof Function) {
		self['on' + eventName].apply(this, params);
	}
	
	return self;
};
	
	

	
var _ = {};

_.isUndefined = function(obj) {
	return (obj === void 0);
};

_.isNull = function(obj) {
	return (obj === null);
};

_.isBool = function(obj) {
	return (typeof obj == "boolean");
};

_.isString = function(obj) {
	return (typeof obj == "string");
};

_.isNumber = function(obj, strict) {
	if(strict) {
		return (typeof obj == "number");
	} else {
		return !isNaN(obj);
	}
};


  
_.isArray = function(obj) {
	return (obj instanceof Array);
	// return toString.call(obj) === '[object Array]';
};

 _.enumerate = function(constArray) {
	var constObj = {};
	
	var j = 0;
	var _const;
	for(var i = 0; i < constArray.length; i++) {
		_const = constArray[i];
		if(_.isArray(_const)) {
			j = _const[1];
			_const = _const[0];
		}
		
		constObj[_const] = j++;
	}
	
	return constObj;
};
			

module.exports = {
  BindClass: BindClass,
  createClass: createClass,
  Timer: Timer,
  _: _
};